<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SNEAI V2</title>
  <link rel="stylesheet" href="static/style.css" />
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <h1>SNEAI V2</h1>
        <span class="tagline">Your Personal AI Assistant</span>
      </div>
      <div class="header-controls">
        <button id="theme-toggle" title="Toggle Theme">üåó</button>
        <button id="help-btn" title="Help">‚ùî</button>
      </div>
    </header>

    <!-- Chat Section -->
    <div class="chat-container">
      <div id="chat-box"></div>
    </div>

    <!-- Features -->
    <div class="features-container">
      <div class="feature-card" id="teach-btn"><i>üìñ</i>Teach</div>
      <div class="feature-card" id="history-btn"><i>üìú</i>History</div>
      <div class="feature-card" id="mode-btn"><i>üí°</i>Modes</div>
    </div>

    <!-- Input -->
    <div class="input-container">
      <input type="text" id="user-input" placeholder="Type your message..." />
      <button id="send-btn">‚û§</button>
    </div>

    <!-- Footer -->
    <footer>
      <p>‚Äî Created by Aman Gupta</p>
    </footer>
  </div>

  <!-- Help Modal -->
  <div id="help-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="help-close">&times;</span>
      <h2>Help & Features</h2>
      <ul>
        <li><b>Teach:</b> Add custom AI replies.</li>
        <li><b>History:</b> View last chats.</li>
        <li><b>Secret Modes:</b> Try <code>s1</code>, <code>sneha</code>, <code>f1</code>.</li>
      </ul>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const chatBox = document.getElementById("chat-box");

    const themeToggle = document.getElementById("theme-toggle");
    const helpBtn = document.getElementById("help-btn");
    const helpModal = document.getElementById("help-modal");
    const helpClose = document.getElementById("help-close");

    const teachBtn = document.getElementById("teach-btn");
    const historyBtn = document.getElementById("history-btn");
    const modeBtn = document.getElementById("mode-btn");

    // Voice reply (Speak only AI's answer)
    function speak(text) {
      const speech = new SpeechSynthesisUtterance(text);
      speech.lang = "en-IN";
      speech.rate = 1;
      window.speechSynthesis.speak(speech);
    }

    // Append messages
    function appendMessage(text, isUser = false) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("message", isUser ? "user-message" : "ai-message");
      msgDiv.innerHTML = `<p>${text}</p>`;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Send message
    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      appendMessage(text, true);
      userInput.value = "";

      try {
        const response = await fetch("/get_response", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });
        const data = await response.json();
        appendMessage(data.reply);
        speak(data.reply);
      } catch (err) {
        appendMessage("Error: Cannot reach server.");
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    // Theme toggle
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-theme");
    });

    // Help modal
    helpBtn.addEventListener("click", () => helpModal.style.display = "flex");
    helpClose.addEventListener("click", () => helpModal.style.display = "none");

    // Teach
    teachBtn.addEventListener("click", () => {
      const pattern = prompt("Enter a word/phrase to teach:");
      const response = prompt("Enter the AI's reply for this:");
      if (pattern && response) {
        fetch("/teach", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ pattern, response })
        }).then(() => alert(`Taught AI: '${pattern}' -> '${response}'`));
      }
    });

    // History
    historyBtn.addEventListener("click", () => {
      fetch("/history").then(res => res.json()).then(data => {
        alert("Chat History:\n\n" + data.history.map(h => `You: ${h.user}\nAI: ${h.sneai}`).join("\n\n"));
      });
    });

    // Modes
    modeBtn.addEventListener("click", () => {
      alert("Try secret triggers: s1, s2, sneha, f1, etc.");
    });
  </script>
</body>
</html>

